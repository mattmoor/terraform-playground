# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  assume-and-list:
    # Specify the execution environment. You can specify an image from Dockerhub or use one of our Convenience Images from CircleCI's Developer Hub.
    # See: https://circleci.com/docs/2.0/configuration-reference/#docker-machine-macos-windows-executor
    docker:
      - image: cimg/base:stable
    # Add steps to the job
    # See: https://circleci.com/docs/2.0/configuration-reference/#steps
    steps:
      - run:
          name: "Download and Auth Chainctl"
          command: |
            cd $(mktemp -d)
            wget -O chainctl "https://dl.${{ inputs.environment }}/chainctl/latest/chainctl_linux_$(uname -m)"
            chmod +x chainctl
            sudo mv chainctl /usr/local/bin

            chainctl auth login --identity 2c8bceb43e0d5542edabccda0a5e77667a4d6cb6/959075557dc5698f --identity-token $CIRCLE_OIDC_TOKEN

      - run:
          name: "Explore stuff with chainctl"
          command: |
            chainctl policy ls


# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  assume-and-list:
    jobs:
      - assume-and-list:
          context:
          - enforce-circleci-example
